<!DOCTYPE html>
<html lang="ja">
<head>
    <!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-7FKGWR8L3Z"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-7FKGWR8L3Z');
</script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç”»åƒä»•æ§˜ï¼†è¦–èªæ€§ãƒã‚§ãƒƒã‚«ãƒ¼ (Neon Theme)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* --- CSSãƒ•ã‚£ãƒ«ã‚¿å®šç¾© --- */
        .blur-mode { filter: blur(3px); }
        .filter-protanopia { filter: url(#protanopia-filter); }
        .filter-deuteranopia { filter: url(#deuteranopia-filter); }

        /* åˆ¤å®šãƒ©ãƒ™ãƒ«ç”¨ã‚«ãƒ©ãƒ¼å®šç¾© (ãƒ­ã‚¸ãƒƒã‚¯ç”¨ã¯å¤‰æ›´ãªã—) */
        .status-blue { background-color: #dbeafe; color: #1e40af; border-left: 5px solid #2563eb; }
        .status-yellow { background-color: #fef9c3; color: #854d0e; border-left: 5px solid #ca8a04; }
        .status-red { background-color: #fee2e2; color: #991b1b; border-left: 5px solid #dc2626; }

        /* ãƒ—ãƒ©ã‚¤ãƒãƒªãƒ¼ã‚«ãƒ©ãƒ¼é©ç”¨ã‚¯ãƒ©ã‚¹ */
        .bg-primary { background-color: #CBFF1C; }
        .text-primary { color: #CBFF1C; }
        .border-primary { border-color: #CBFF1C; }
        
        /* ãƒ›ãƒãƒ¼æ™‚ã®æŒ™å‹•ï¼ˆå°‘ã—æš—ãã™ã‚‹ï¼‰ */
        .hover-primary:hover { background-color: #b3e600; }
    </style>
</head>
<body class="bg-gray-100 text-gray-800 p-6 min-h-screen">

    <svg style="display: none;">
        <defs>
            <filter id="protanopia-filter">
                <feColorMatrix type="matrix" values="0.567, 0.433, 0, 0, 0  0.558, 0.442, 0, 0, 0  0, 0.242, 0.758, 0, 0  0, 0, 0, 1, 0" />
            </filter>
            <filter id="deuteranopia-filter">
                <feColorMatrix type="matrix" values="0.625, 0.375, 0, 0, 0  0.7, 0.3, 0, 0, 0  0, 0.3, 0.7, 0, 0  0, 0, 0, 1, 0" />
            </filter>
        </defs>
    </svg>

    <div class="max-w-5xl mx-auto bg-white p-8 rounded-xl shadow-lg border-t-8 border-[#CBFF1C]">
        <h1 class="text-3xl font-extrabold mb-2 text-gray-900 tracking-tight">
            Misskey.io<br>ç”³è«‹ã‚«ã‚¹ã‚¿ãƒ çµµæ–‡å­—ç”¨<br>ç”»åƒä»•æ§˜ï¼†è¦–èªæ€§ãƒã‚§ãƒƒã‚«ãƒ¼
        </h1>
        <p class="text-sm text-gray-500 mb-6">ã‚µãƒ¼ãƒãƒ¼é€ä¿¡ãªã— / ãƒ­ãƒ¼ã‚«ãƒ«å®Œçµå‹ãƒ„ãƒ¼ãƒ«<br>ã‚ãã¾ã§åŸºæº–ã¨ã—ã¦ãŠä½¿ã„ãã ã•ã„ã€‚<br>ã“ã®ãƒã‚§ãƒƒã‚«ãƒ¼ã§OKãŒå‡ºã¦ã‚‚ç¢ºå®Ÿã«ç”³è«‹ãŒã§ãã‚‹ã¨ã¯é™ã‚Šã¾ã›ã‚“ã€‚</p>
        
        <div id="dropZone" class="group border-4 border-dashed border-gray-300 rounded-xl p-12 text-center hover:border-[#CBFF1C] hover:bg-[#CBFF1C]/10 transition-all cursor-pointer duration-300">
            <div class="pointer-events-none">
                <p class="text-gray-400 font-bold text-xl group-hover:text-gray-600 transition-colors">ã“ã“ã«ç”»åƒã‚’ãƒ‰ãƒ­ãƒƒãƒ—</p>
                <p class="text-sm text-gray-400 mt-2">å¯¾å¿œå½¢å¼: WebP, PNG, GIF</p>
            </div>
            <input type="file" id="fileInput" class="hidden" accept="image/png, image/gif, image/webp">
        </div>

        <div id="resultArea" class="hidden mt-10 animate-fade-in">
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-10">
                <div>
                    <h2 class="text-xl font-bold mb-4 border-b-2 border-gray-100 pb-2 flex items-center gap-3">
                        â‘  ä»•æ§˜ãƒã‚§ãƒƒã‚¯
                        <span id="fileTypeLabel" class="text-xs font-bold px-2 py-1 bg-gray-800 text-[#CBFF1C] rounded uppercase tracking-wider"></span>
                    </h2>
                    <ul id="specList" class="space-y-3 text-sm"></ul>
                </div>

                <div>
                    <h2 class="text-xl font-bold mb-4 border-b-2 border-gray-100 pb-2">â‘¡ è¦–èªæ€§ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³</h2>
                    
                    <div class="mb-6 space-y-5 bg-gray-50 p-4 rounded-lg">
                        
                        <div>
                            <p class="text-xs font-bold text-gray-500 mb-2 uppercase tracking-wide">èƒŒæ™¯è‰² (é€éãƒã‚§ãƒƒã‚¯)</p>
                            <div class="flex gap-2">
                                <button onclick="setBgMode('light')" class="flex-1 py-1.5 border rounded shadow-sm bg-white text-gray-800 hover:bg-gray-100 text-xs font-bold transition">â˜€ ãƒ©ã‚¤ãƒˆ</button>
                                <button onclick="setBgMode('dark')" class="flex-1 py-1.5 border rounded shadow-sm bg-gray-900 text-white hover:bg-black text-xs font-bold transition">ğŸŒ™ ãƒ€ãƒ¼ã‚¯</button>
                                <button onclick="setBgMode('check')" class="flex-1 py-1.5 border rounded shadow-sm bg-gray-200 text-gray-600 text-xs transition">ğŸ é€æ˜</button>
                            </div>
                        </div>

                        <div>
                            <p class="text-xs font-bold text-gray-500 mb-2 uppercase tracking-wide">è¦‹ãˆæ–¹ãƒ»ã‚³ãƒ³ãƒˆãƒ©ã‚¹ãƒˆ</p>
                            <div class="flex flex-wrap gap-2">
                                <button onclick="setMode('normal')" class="filter-btn px-3 py-1.5 rounded text-xs font-bold shadow-sm transition" data-mode="normal">é€šå¸¸</button>
                                <button onclick="setMode('protanopia')" class="filter-btn px-3 py-1.5 rounded text-xs font-bold shadow-sm transition" data-mode="protanopia">På‹ (èµ¤NG)</button>
                                <button onclick="setMode('deuteranopia')" class="filter-btn px-3 py-1.5 rounded text-xs font-bold shadow-sm transition" data-mode="deuteranopia">Då‹ (ç·‘NG)</button>
                                <button onclick="setMode('blur')" class="filter-btn px-3 py-1.5 rounded text-xs font-bold shadow-sm transition" data-mode="blur">ã¼ã‹ã—</button>
                                <button onclick="setMode('edge')" class="filter-btn px-3 py-1.5 rounded text-xs font-bold shadow-sm transition border-2 border-gray-800" data-mode="edge">å¢ƒç•Œç·šæŠ½å‡º</button>
                            </div>
                            <p class="text-xs text-red-500 mt-2 hidden font-bold bg-red-50 p-2 rounded" id="edgeNote">âš ï¸ çœŸã£é»’ã§æ–‡å­—ãŒèª­ã‚ãªã„å ´åˆã€ã‚³ãƒ³ãƒˆãƒ©ã‚¹ãƒˆãŒä¸è¶³ã—ã¦ã„ã¾ã™ã€‚</p>
                        </div>
                    </div>

                    <div id="previewContainer" class="border-2 border-gray-200 p-4 bg-[url('https://www.transparenttextures.com/patterns/cubes.png')] bg-gray-100 flex justify-center items-center min-h-[250px] rounded-lg relative overflow-hidden transition-colors duration-300">
                        <img id="previewImage" class="max-w-full h-auto max-h-64 object-contain transition duration-300 absolute" style="display: block;">
                        <canvas id="edgeCanvas" class="max-w-full h-auto max-h-64 object-contain absolute" style="display: none;"></canvas>
                    </div>

                    <div class="mt-6">
                        <a href="https://misskey-hub.net/ja/tools/custom-emoji-preview/" target="_blank" rel="noopener noreferrer" 
                           class="group flex items-center justify-center w-full bg-[#CBFF1C] hover:bg-[#b3e600] text-black font-bold py-3 px-4 rounded-lg transition-all shadow-md transform hover:translate-y-[-1px]">
                            <span class="mr-2 text-lg group-hover:scale-110 transition-transform">ğŸš€</span> Misskey ã‚«ã‚¹ã‚¿ãƒ çµµæ–‡å­—ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã¸
                        </a>
                    </div>

                </div>
            </div>
        </div>
    </div>

    <script>
        const dropZone = document.getElementById('dropZone');
        const fileInput = document.getElementById('fileInput');
        const resultArea = document.getElementById('resultArea');
        const previewImage = document.getElementById('previewImage');
        const previewContainer = document.getElementById('previewContainer');
        const edgeCanvas = document.getElementById('edgeCanvas');
        const specList = document.getElementById('specList');
        const fileTypeLabel = document.getElementById('fileTypeLabel');
        const filterBtns = document.querySelectorAll('.filter-btn');
        const edgeNote = document.getElementById('edgeNote');

        let currentSourceImage = null;

        // --- ã‚¤ãƒ™ãƒ³ãƒˆè¨­å®š ---
        dropZone.addEventListener('dragover', (e) => { e.preventDefault(); dropZone.classList.add('border-[#CBFF1C]', 'bg-[#CBFF1C]/10'); });
        dropZone.addEventListener('dragleave', () => { dropZone.classList.remove('border-[#CBFF1C]', 'bg-[#CBFF1C]/10'); });
        dropZone.addEventListener('drop', (e) => { 
            e.preventDefault(); 
            dropZone.classList.remove('border-[#CBFF1C]', 'bg-[#CBFF1C]/10'); 
            handleFiles(e.dataTransfer.files); 
        });
        dropZone.addEventListener('click', () => fileInput.click());
        fileInput.addEventListener('change', (e) => handleFiles(e.target.files));

        async function handleFiles(files) {
            if (files.length === 0) return;
            const file = files[0];
            const arrayBuffer = await file.arrayBuffer();
            const isAnim = isAnimated(file, arrayBuffer);
            const blob = new Blob([arrayBuffer], { type: file.type });
            const url = URL.createObjectURL(blob);
            const img = new Image();
            img.onload = () => {
                currentSourceImage = img;
                runCheck(file, img, isAnim);
                setMode('normal');
                setBgMode('light'); 
                URL.revokeObjectURL(url);
            };
            img.src = url;
            previewImage.src = url;
        }

        // --- ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³åˆ¤å®š ---
        function isAnimated(file, buffer) {
            const uint8 = new Uint8Array(buffer);
            if (file.type === 'image/gif') return true;
            if (file.type === 'image/png') {
                const hex = [...uint8.slice(0, 1000)].map(b => b.toString(16).padStart(2, '0')).join('');
                return hex.includes('6163544c');
            }
            if (file.type === 'image/webp') {
                const text = new TextDecoder().decode(uint8.slice(0, 100));
                return text.includes('ANIM');
            }
            return false;
        }

        // --- ä»•æ§˜åˆ¤å®š ---
        function runCheck(file, img, isAnim) {
            resultArea.classList.remove('hidden');
            specList.innerHTML = '';
            fileTypeLabel.innerText = isAnim ? 'ANIMATION' : 'STATIC';
            
            // å½¢å¼
            const validFormats = ['image/png', 'image/gif', 'image/webp'];
            let formatStatus = validFormats.includes(file.type) ? 'blue' : 'red';
            let msg = file.type.split('/')[1].toUpperCase();
            if(formatStatus === 'red') msg += ' (æœªå¯¾å¿œ)';
            else if(file.type !== 'image/webp') msg += ' (WebPæ¨å¥¨)';
            else msg += ' (æ¨å¥¨)';
            addResultItem('ãƒ•ã‚¡ã‚¤ãƒ«å½¢å¼', msg, formatStatus);

            // è§£åƒåº¦
            addResultItem('å¹… (1500pxä»¥ä¸‹)', `${img.width} px`, img.width <= 1500 ? 'blue' : 'red');
            addResultItem('é«˜ã• (256pxä»¥ä¸‹)', `${img.height} px`, img.height <= 256 ? 'blue' : 'red');

            // å®¹é‡
            const kb = file.size / 1024;
            const base = isAnim ? 64 : 10;
            const max = isAnim ? 84 : 30;
            let sizeStatus = kb > max ? 'red' : (kb > base ? 'yellow' : 'blue');
            addResultItem(`å®¹é‡ (${base}KBç›®å®‰)`, `${kb.toFixed(1)} KB`, sizeStatus);
        }

        function addResultItem(label, value, statusColor) {
            const li = document.createElement('li');
            li.className = `flex justify-between items-center p-3 rounded shadow-sm status-${statusColor}`;
            let icon = statusColor === 'blue' ? 'ğŸ”µ OK' : (statusColor === 'yellow' ? 'ğŸŸ¡ æ³¨æ„' : 'ğŸ”´ è­¦å‘Š');
            li.innerHTML = `<span class="font-bold">${label}</span> <div class="text-right"><div>${value}</div><div class="text-xs opacity-75">${icon}</div></div>`;
            specList.appendChild(li);
        }

        // --- èƒŒæ™¯è‰²åˆ‡ã‚Šæ›¿ãˆ ---
        function setBgMode(mode) {
            if (mode === 'check') {
                previewContainer.style.backgroundImage = "url('https://www.transparenttextures.com/patterns/cubes.png')";
                previewContainer.style.backgroundColor = '#f3f4f6';
            } else {
                previewContainer.style.backgroundImage = 'none';
                if (mode === 'light') previewContainer.style.backgroundColor = '#FFFFFF';
                if (mode === 'dark') previewContainer.style.backgroundColor = '#0A0A0A';
            }
        }

        // --- ãƒ•ã‚£ãƒ«ã‚¿åˆ‡ã‚Šæ›¿ãˆ ---
        function setMode(mode) {
            // å…¨ãƒœã‚¿ãƒ³ãƒªã‚»ãƒƒãƒˆ
            filterBtns.forEach(btn => {
                btn.className = 'filter-btn px-3 py-1.5 rounded text-xs font-bold shadow-sm transition bg-white text-gray-700 border border-gray-300 hover:bg-gray-50';
                if(btn.dataset.mode === 'edge') btn.classList.add('bg-gray-800', 'text-white', 'border-gray-800', 'hover:bg-gray-900');
            });

            // ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãƒœã‚¿ãƒ³è¨­å®š (ãƒ—ãƒ©ã‚¤ãƒãƒªãƒ¼ã‚«ãƒ©ãƒ¼é©ç”¨)
            const activeBtn = document.querySelector(`button[data-mode="${mode}"]`);
            if(activeBtn) {
                if(mode === 'edge') {
                    // ã‚¨ãƒƒã‚¸ãƒ¢ãƒ¼ãƒ‰ã¯ç‰¹åˆ¥æ‰±ã„ï¼ˆé»’èƒŒæ™¯ã®ã¾ã¾å¼·èª¿ï¼‰
                    activeBtn.className = 'filter-btn px-3 py-1.5 rounded text-xs font-bold shadow-sm transition bg-black text-[#CBFF1C] border-black ring-2 ring-[#CBFF1C] ring-offset-1';
                } else {
                    // é€šå¸¸ãƒ•ã‚£ãƒ«ã‚¿ã¯ãƒ—ãƒ©ã‚¤ãƒãƒªãƒ¼ã‚«ãƒ©ãƒ¼èƒŒæ™¯ + é»’æ–‡å­—
                    activeBtn.className = 'filter-btn px-3 py-1.5 rounded text-xs font-bold shadow-sm transition bg-[#CBFF1C] text-black border-[#CBFF1C] hover:bg-[#b3e600]';
                }
            }

            // ç”»é¢å‡¦ç†
            if (mode === 'edge') {
                previewImage.style.display = 'none';
                edgeCanvas.style.display = 'block';
                edgeNote.classList.remove('hidden');
                applyEdgeDetection(currentSourceImage);
            } else {
                previewImage.style.display = 'block';
                edgeCanvas.style.display = 'none';
                edgeNote.classList.add('hidden');
                previewImage.className = 'max-w-full h-auto max-h-64 object-contain transition duration-300 absolute';
                if (mode === 'blur') previewImage.classList.add('blur-mode');
                if (mode === 'protanopia') previewImage.classList.add('filter-protanopia');
                if (mode === 'deuteranopia') previewImage.classList.add('filter-deuteranopia');
            }
        }

        // --- å¢ƒç•Œç·šæŠ½å‡º (Canvas) ---
        function applyEdgeDetection(img) {
            if (!img) return;
            const ctx = edgeCanvas.getContext('2d');
            edgeCanvas.width = img.width;
            edgeCanvas.height = img.height;
            ctx.drawImage(img, 0, 0);
            const imageData = ctx.getImageData(0, 0, edgeCanvas.width, edgeCanvas.height);
            const data = imageData.data;
            const width = edgeCanvas.width;
            const height = edgeCanvas.height;
            const outputData = ctx.createImageData(width, height);
            const output = outputData.data;
            const getGray = (i) => 0.299 * data[i] + 0.587 * data[i + 1] + 0.114 * data[i + 2];

            for (let y = 1; y < height - 1; y++) {
                for (let x = 1; x < width - 1; x++) {
                    const i = (y * width + x) * 4;
                    const gx = Math.abs(getGray(i+4) - getGray(i-4));
                    const gy = Math.abs(getGray(i + width*4) - getGray(i - width*4));
                    let val = (gx + gy) > 100 ? 255 : 0;
                    output[i] = val; output[i + 1] = val; output[i + 2] = val; output[i + 3] = 255;
                }
            }
            ctx.putImageData(outputData, 0, 0);
        }
    </script>
</body>
</html>
